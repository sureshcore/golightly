TARGET	= gl
SRCS	= gl.c ast.c codegen_jit.c codegen_llvm.c
GENSRCS	= golexer.yy.c goparser.tab.c
GENHDRS	= goparser.tab.h
OBJS	:= $(SRCS:%.c=%.o) $(GENSRCS:%.c=%.o)
CFLAGS  = -Wall -g
LIBS    = -ljit -ldl -lm -lpthread

all: $(TARGET)

$(TARGET): $(OBJS)
	$(CC) -o $(TARGET) $(OBJS) $(LIBS)

golexer.yy.c golexer.yy.h: golexer.l
	flex golexer.l

goparser.tab.c goparser.tab.h: goparser.y
	bison -b goparser goparser.y

clean:
	rm -f $(TARGET) $(OBJS) $(GENSRCS) $(GENHDRS)

dep:    $(GENSRCS)
	( ( awk '{ if (!omit) print $$0; if ($$0 == "# Auto-generated by make dep.") omit=1 }' < Makefile ; gcc -MM $(CFLAGS) $(SRCS) $(GENSRCS) ) >it && mv it Makefile )

# Auto-generated by make dep.
gl.o: gl.c gl.h ast.h codegen_jit.h
ast.o: ast.c ast.h
codegen_jit.o: codegen_jit.c ast.h codegen_jit.h
codegen_llvm.o: codegen_llvm.c gl.h ast.h
golexer.yy.o: golexer.yy.c ast.h goparser.tab.h
goparser.tab.o: goparser.tab.c ast.h gl.h goparser.tab.h
